let carte0 = [|
[|0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;|];
[|0;0;0;0;0;0;1;1;1;1;1;1;1;1;1;0;0;0;0;0;0;0;0;|];
[|0;0;0;0;0;1;1;1;1;1;1;1;1;1;1;1;1;0;0;0;0;0;0;|];
[|0;0;0;0;0;0;0;1;1;1;1;1;1;1;1;1;1;1;0;0;0;0;0;|];
[|0;0;0;0;0;0;0;0;0;0;0;1;1;1;1;1;0;0;0;0;0;0;0;|];
[|0;0;0;0;0;0;0;0;0;0;0;0;1;1;1;0;0;0;0;0;0;0;0;|];
[|0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;|]
|];;


let carte1 = [|
[|0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;|];
[|0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;|];
[|0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;|];
[|0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;|];
[|0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;|];
[|0;0;0;0;0;1;1;1;1;1;1;1;1;1;1;0;0;0;0;0;0;0;0;|];
[|0;0;0;0;0;1;1;1;1;1;1;1;1;1;1;1;1;0;0;0;0;0;0;|];
[|0;0;0;0;0;0;0;1;1;1;1;1;1;1;1;1;1;1;0;0;0;0;0;|];
[|0;0;0;0;0;0;0;1;1;1;1;1;1;1;1;1;1;1;0;0;0;0;0;|];
[|0;0;0;0;0;0;0;1;1;1;1;1;1;1;1;1;1;1;0;0;0;0;0;|];
[|0;0;0;0;0;0;0;0;1;1;1;1;1;1;1;1;1;1;1;0;0;0;0;|];
[|0;0;0;1;1;0;0;0;1;1;1;1;1;1;1;1;1;1;1;0;0;0;0;|];
[|0;0;0;1;1;1;0;0;1;1;1;1;1;1;1;1;1;1;1;0;0;0;0;|];
[|0;0;0;1;1;0;0;0;0;1;1;1;1;1;1;1;1;1;0;0;0;0;0;|];
[|0;0;0;1;1;0;0;0;0;0;1;1;1;1;1;1;1;1;0;0;0;0;0;|];
[|0;0;0;0;0;0;0;0;0;0;0;0;1;1;1;1;0;0;0;0;0;0;0;|];
[|0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;|];
[|0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;|]
|];;

let carte2 = [|
[|0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;|];
[|0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;|];
[|0;0;0;0;0;1;1;1;1;0;0;0;0;0;0;1;1;1;0;0;0;0;0;|];
[|0;0;0;1;1;1;1;1;1;1;0;0;0;1;1;1;1;1;1;0;0;0;0;|];
[|0;0;1;1;1;1;1;1;1;1;0;0;0;0;1;1;1;1;1;1;1;0;0;|];
[|0;0;1;1;1;1;1;1;1;1;1;0;0;0;1;1;1;1;1;1;1;1;0;|];
[|0;0;1;1;1;1;1;1;1;1;1;0;0;0;0;1;1;1;1;0;1;1;0;|];
[|0;0;1;1;1;1;1;0;0;0;1;1;0;0;0;1;1;1;1;0;1;1;0;|];
[|0;0;1;1;1;1;0;0;0;0;0;1;0;0;0;0;1;1;1;0;1;1;0;|];
[|0;0;1;1;1;1;0;0;0;0;0;1;1;0;0;0;1;1;0;0;1;1;0;|];
[|0;0;0;1;1;1;0;0;0;0;0;1;0;0;0;0;1;1;0;0;1;0;0;|];
[|0;0;0;1;1;1;1;0;0;0;1;1;0;0;0;0;1;1;0;1;1;0;0;|];
[|0;0;0;1;1;1;1;0;0;0;1;0;0;0;0;0;1;1;1;1;0;0;0;|];
[|0;0;0;0;1;1;1;1;1;1;1;0;0;0;0;0;1;1;1;0;0;0;0;|];
[|0;0;0;0;0;1;1;1;1;1;1;0;0;0;0;0;0;0;0;0;0;0;0;|];
[|0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;|];
[|0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;|];
[|0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;0;|]
|];;

let carte3 = [|
[|0;0;0;0;0|];
[|0;1;1;1;0|];
[|0;1;1;1;0|];
[|0;1;1;1;0|];
[|0;0;0;0;0|]
|]

(* affiche un tabelau 2D *)
let affiche_ligne t = 
  for i = 0 to Array.length t - 1 do
    Printf.printf "%d-" t.(i)
  done;
  Printf.printf "\n"

let affiche tab =
 let n = Array.length tab in
 for i = 0 to n - 1 do
   affiche_ligne tab.(i)
 done;;

let rec afficheliste l =
  match l with
  | [] -> ()
  | x::ll -> Printf.printf "%d " x; afficheliste ll;
  Printf.printf "\n"
;;

affiche carte0;;
Printf.printf "\n\n";;

let existe x y length height =
  (*Vérifie que les coord fournies existent*)
  x >= 0 && x < length && y >= 0 && y < height
;;

let voisins carte x y length height =
  (*Renvoie une liste contenant les cases se trouvant au nord, à l'est, à l'ouest et au sud de carte.(x).(y)*)
  let lcoord = 0::-1::-1::0::1::0::0::1::[] in
  let rec aux l x y length height =
    match l with
    | [] -> []
    | i::j::ll -> if existe (x+i) (y+j) length height then x+i::y+j::aux ll x y length height
                  else aux ll x y length height
    | i::ll -> failwith "Liste mal encodée"
  in
  aux lcoord x y length height
;;

let toucheterre carte x y length height =
  (*Regarde si carte.(x).(y) se trouve à côté d'une case de terre*)
  let rec aux l =
    match l with
    | [] -> false
    | x::y::ll -> if carte.(x).(y) = 0 then true else aux ll
    | x::ll -> failwith "Liste mal encodée"
  in
  let liste = voisins carte x y length height in
  aux liste
;;

let rec transfovois carte l =
  (*Transforme toute les cases de carte de coord se trouvant dans l en case de terre*)
  match l with
  | [] -> ()
  | x::y::ll -> carte.(x).(y) <- 0; transfovois carte ll
  | x::ll -> failwith "Liste mal encodée"
;;
  

let profondeur carte =
  let prof = ref 0 in
  let length = Array.length carte in
  let height = Array.length carte.(0) in
  let l = ref [] in
  let fini = ref false in
  while not !fini do
    (*Tant qu'on continue à transformer des cases en case terre, c'est que l'on n'a pas atteint le fond*)
    l := [];
    for i = 0 to (length-1) do
      for j = 0 to (height-1) do
        if carte.(i).(j) = 1 && toucheterre carte i j length height then
          l := !l@i::j::[]
      done;
    done;
    if !l <> [] then
      (prof := !prof + 1;
      transfovois carte !l)
    else fini := true
  done;
  !prof
;;


Printf.printf "La prof de la carte0 est %d\n" (profondeur carte0);;
Printf.printf "La prof de la carte1 est %d\n" (profondeur carte1);;
Printf.printf "La prof de la carte2 est %d\n" (profondeur carte2);;
Printf.printf "La prof de la carte3 est %d\n" (profondeur carte3);;